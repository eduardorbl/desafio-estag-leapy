name: Coin Change CI

on:
  pull_request:
    paths:
      - "02-coin-change/**"
  push:
    paths:
      - "02-coin-change/**"

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Build candidate image
        working-directory: 02-coin-change
        run: |
          if [ -f Dockerfile ]; then
            docker build -t coin-change-candidate .
          else
            echo "Dockerfile nÃ£o encontrado. O candidato deve fornecer um Dockerfile na raiz de 02-coin-change" >&2
            exit 1
          fi

      - name: Run tests with harness inside container
        working-directory: 02-coin-change
        run: |
          docker run --rm \
            -v "$PWD/tests:/tests:ro" \
            -v "$PWD/runner.yml:/runner.yml:ro" \
            coin-change-candidate \
            sh -lc "node -e 'process.exit(0)' >/dev/null 2>&1 || apk add --no-cache nodejs npm >/dev/null 2>&1 || true; \
            node /tests/harness.js || (echo \"Falha no harness. Verifique contrato de I/O e runner.yml\" >&2; exit 1)"
