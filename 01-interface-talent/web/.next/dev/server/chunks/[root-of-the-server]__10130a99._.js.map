{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/eduardosrbl/Downloads/leapy/desafio-estag-leapy/01-interface-talent/web/src/app/api/talents/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nexport async function GET(req: Request) {\n  const url = process.env.DIRECTUS_URL;\n  const token = process.env.DIRECTUS_STATIC_TOKEN;\n\n  if (!url || !token) {\n    return NextResponse.json(\n      { ok: false, error: 'Missing DIRECTUS_URL or DIRECTUS_STATIC_TOKEN' },\n      { status: 500 }\n    );\n  }\n\n  const { searchParams } = new URL(req.url);\n\n  // paginação / busca\n  const page = searchParams.get('page') ?? '1';\n  const limit = searchParams.get('limit') ?? '10';\n  const q = searchParams.get('q') ?? '';\n\n  // filtros vindos do front (já existentes na tua UI)\n  const department = searchParams.get('department') ?? '';\n  const current_status = searchParams.get('current_status') ?? '';\n  const pdi_plan_ready = searchParams.get('pdi_plan_ready') ?? ''; // 'true' | 'false' | ''\n  const orchestrator_state = searchParams.get('orchestrator_state') ?? '';\n  const start_date_gte = searchParams.get('start_date_gte') ?? '';\n  const end_date_lte = searchParams.get('end_date_lte') ?? '';\n  const leader_id = searchParams.get('leader_id') ?? '';\n  const target_role_id = searchParams.get('target_role_id') ?? '';\n\n  // ordenação (default = -date_updated)\n  const sort = searchParams.get('sort') ?? '-date_updated';\n\n  const qs = new URLSearchParams();\n\n  // campos + paginação + meta (incluindo campos relacionados)\n  qs.set(\n    'fields',\n    [\n      'id',\n      'department',\n      'current_status',\n      'pdi_plan_ready',\n      'orchestrator_state',\n      'start_date',\n      'end_date',\n      'date_updated',\n      'date_created',\n      'phone_number',\n      'current_cycle',\n      // nomes do usuário\n      'user_id.email',\n      'user_id.first_name',\n      'user_id.last_name',\n      // líder\n      'leader_id.user_id.email',\n      // target role (nome)\n      'target_role_id.name',\n    ].join(',')\n  );\n  qs.append('sort[]', sort);\n  qs.set('limit', limit);\n  qs.set('page', page);\n  qs.set('meta', '*');\n\n  // busca por e-mail do usuário relacionado\n  if (q) qs.set('filter[user_id][email][_icontains]', q);\n\n  // filtros simples (suporta _null para buscar valores vazios)\n  if (department) {\n    if (department === '_null') {\n      qs.set('filter[department][_null]', 'true');\n    } else {\n      qs.set('filter[department][_eq]', department);\n    }\n  }\n  if (current_status) {\n    if (current_status === '_null') {\n      qs.set('filter[current_status][_null]', 'true');\n    } else {\n      qs.set('filter[current_status][_eq]', current_status);\n    }\n  }\n  if (pdi_plan_ready) {\n    if (pdi_plan_ready === '_null') {\n      qs.set('filter[pdi_plan_ready][_null]', 'true');\n    } else {\n      qs.set('filter[pdi_plan_ready][_eq]', pdi_plan_ready); // 'true'/'false'\n    }\n  }\n  if (orchestrator_state) {\n    if (orchestrator_state === '_null') {\n      qs.set('filter[orchestrator_state][_null]', 'true');\n    } else {\n      qs.set('filter[orchestrator_state][_eq]', orchestrator_state);\n    }\n  }\n\n  // intervalo de datas\n  if (start_date_gte) qs.set('filter[start_date][_gte]', start_date_gte);\n  if (end_date_lte) qs.set('filter[end_date][_lte]', end_date_lte);\n\n  // relacionais por id (suporta _null para buscar valores vazios)\n  if (leader_id) {\n    if (leader_id === '_null') {\n      qs.set('filter[leader_id][_null]', 'true');\n    } else {\n      qs.set('filter[leader_id][_eq]', leader_id);\n    }\n  }\n  if (target_role_id) {\n    if (target_role_id === '_null') {\n      qs.set('filter[target_role_id][_null]', 'true');\n    } else {\n      qs.set('filter[target_role_id][_eq]', target_role_id);\n    }\n  }\n\n  const directusUrl = `${url}/items/talents?${qs.toString()}`;\n\n  try {\n    const res = await fetch(directusUrl, {\n      headers: { Authorization: `Bearer ${token}` },\n      cache: 'no-store',\n    });\n\n    const data = await res.json().catch(() => ({}));\n    return NextResponse.json(data, { status: res.status });\n  } catch (err: unknown) {\n    const message = err instanceof Error ? err.message : String(err);\n    return NextResponse.json({ ok: false, error: message }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}